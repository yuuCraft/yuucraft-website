<script>
/* ===== è¨­å®š ===== */
const BASE_PATH = "/tools/";
const NEW_DAYS = 7; // ä½•æ—¥ä»¥å†…ã‚’NEWã«ã™ã‚‹

/* ===== ãƒ„ãƒ¼ãƒ«å®šç¾© ===== */
const tools = [
{
    name: "IP Address",
    desc: "ç¾åœ¨ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤º",
    path: "ip-address",
    category: "Network",
    icon: "ğŸŒ",
    added: "2026-02-07"
},
{
    name: "IP Address+",
    desc: "IPã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º",
    path: "ip-address+",
    category: "Network",
    icon: "âš¡",
    added: "2026-02-07"
},
{
    name: "IP Checker",
    desc: "IPã‚’æ¤œç´¢",
    path: "ip-checker",
    category: "Network",
    icon: "ğŸ”",
    added: "2026-02-07"
},

/* å¤–éƒ¨ãƒªãƒ³ã‚¯ä¾‹ */
{
    name: "å¤–éƒ¨ãƒ„ãƒ¼ãƒ«",
    desc: "å¤–éƒ¨ã‚µã‚¤ãƒˆ",
    url: "https://example.com",
    external: true,
    category: "External",
    icon: "ğŸŒ",
    added: "2026-02-08"
}
];

/* ===== ä½¿ç”¨å›æ•° ===== */
function getUsage(){
    return JSON.parse(localStorage.getItem("tool_usage") || "{}");
}

function addUsage(name){
    const usage = getUsage();
    usage[name] = (usage[name] || 0) + 1;
    localStorage.setItem("tool_usage", JSON.stringify(usage));
}

/* ===== URLç”Ÿæˆ ===== */
function getToolUrl(tool){
    if(tool.external) return tool.url;
    return BASE_PATH + tool.path + "/";
}

/* ===== NEWåˆ¤å®š ===== */
function isNew(dateStr){
    if(!dateStr) return false;
    const added = new Date(dateStr);
    const now = new Date();
    const diff = (now - added) / (1000*60*60*24);
    return diff <= NEW_DAYS;
}

/* ===== è¡¨ç¤º ===== */
const grid = document.getElementById("toolGrid");
const search = document.getElementById("search");
const categoriesDiv = document.getElementById("categories");

let currentCategory = "All";

function getCategories(){
    const cats = ["All"];
    tools.forEach(t=>{
        if(!cats.includes(t.category)) cats.push(t.category);
    });
    return cats;
}

function renderCategories(){
    categoriesDiv.innerHTML = "";
    getCategories().forEach(cat=>{
        const btn = document.createElement("button");
        btn.textContent = cat;
        btn.className = "cat-btn" + (cat===currentCategory?" active":"");
        btn.onclick = ()=>{
            currentCategory = cat;
            renderCategories();
            renderTools();
        };
        categoriesDiv.appendChild(btn);
    });
}

function renderTools(){
    const keyword = search.value.toLowerCase();
    const usage = getUsage();
    grid.innerHTML = "";

    tools.forEach(tool=>{
        if(currentCategory !== "All" && tool.category !== currentCategory) return;
        if(!tool.name.toLowerCase().includes(keyword) &&
           !tool.desc.toLowerCase().includes(keyword)) return;

        const url = getToolUrl(tool);
        const count = usage[tool.name] || 0;
        const newLabel = isNew(tool.added) ? `<span style="color:red;font-size:12px;margin-left:6px;">NEW</span>` : "";

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <div>
                <div class="icon">${tool.icon}</div>
                <h3>${tool.name} ${newLabel}</h3>
                <p>${tool.desc}</p>
                <small style="color:var(--accent)">${tool.category}</small><br>
                <small>ä½¿ç”¨å›æ•°: ${count}</small>
            </div>
            <button class="open-btn">ä½¿ç”¨</button>
        `;

        card.querySelector("button").onclick = ()=>{
            addUsage(tool.name);
            location.href = url;
        };

        grid.appendChild(card);
    });

    renderRanking();
}

search.addEventListener("input", renderTools);

/* ===== äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚° ===== */
function renderRanking(){
    let rankingDiv = document.getElementById("ranking");

    if(!rankingDiv){
        rankingDiv = document.createElement("div");
        rankingDiv.id = "ranking";
        rankingDiv.style.marginTop = "40px";
        grid.parentNode.appendChild(rankingDiv);
    }

    const usage = getUsage();

    const sorted = [...tools].sort((a,b)=>{
        return (usage[b.name]||0) - (usage[a.name]||0);
    }).slice(0,5);

    rankingDiv.innerHTML = "<h2>äººæ°—ãƒ„ãƒ¼ãƒ«</h2>";

    sorted.forEach((tool,i)=>{
        const url = getToolUrl(tool);
        const count = usage[tool.name] || 0;

        const item = document.createElement("div");
        item.style.margin = "6px 0";
        item.innerHTML = `${i+1}. <a href="${url}">${tool.name}</a> (${count})`;
        rankingDiv.appendChild(item);
    });
}

/* ===== åˆæœŸè¡¨ç¤º ===== */
renderCategories();
renderTools();
</script>
